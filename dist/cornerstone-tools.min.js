var cornerstoneTools=function(a,b,c,d){function e(c){var d=c.currentTarget,e=k[d];if(c.which==e.whichMouseButton){var f=b.pageToImage(d,c.pageX,c.pageY);e.startX=f.x,e.startY=f.y,e.endX=f.x,e.endY=f.y,e.lengthVisible=!0,a(document).mousemove(function(a){var c=b.pageToImage(d,a.pageX,a.pageY);e.endX=c.x,e.endY=c.y,b.updateImage(d)}),a(document).mouseup(function(){a(document).unbind("mousemove"),a(document).unbind("mouseup")})}}function f(a,b){var c=a.width/2,d=a.height/2;if(0>=c||0>=d)return!1;var e={x:a.left+c,y:a.top+d},f={x:b.x-e.x,y:b.y-e.y},g=f.x*f.y/(c*c)+f.y*f.y/(d*d)<=1;return g}function g(a,b){for(var c=0,d=0,e=0,g=0,h=b.top;h<b.top+b.height;h++)for(var i=b.left;i<b.left+b.width;i++)1==f(b,{x:i,y:h})&&(c+=a[g],d+=a[g]*a[g],e++),g++;if(0==e)return{count:e,mean:0,variance:0,stdDev:0};var j=c/e,k=d/e-j*j;return{count:e,mean:j,variance:k,stdDev:Math.sqrt(k)}}function h(a){var d=k[a.detail.element];if(0!=d.lengthVisible){var e=Math.abs(d.startX-d.endX),f=Math.abs(d.startY-d.endY),h=Math.min(d.startX,d.endX),i=Math.min(d.startY,d.endY),j=(d.startX+d.endX)/2,l=(d.startY+d.endY)/2,m=a.detail.canvasContext;m.beginPath(),m.strokeStyle="white",m.lineWidth=a.detail.singlePixelLineWidth,m.beginPath(),c.drawEllipse(m,h,i,e,f),m.stroke(),m.fillStyle="white",m.font=a.detail.mediumFontSize+" Arial";var n=b.getStoredPixels(a.detail.element,h,i,e,f),o={left:h,top:i,width:e,height:f},p=g(n,o),q=Math.PI*(e*a.detail.image.columnPixelSpacing/2)*(f*a.detail.image.rowPixelSpacing/2),q="Area: "+q.toFixed(2)+" mm^2",r=m.measureText(q),s=15/a.detail.viewport.scale,t=j<a.detail.image.columns/2?j+e/2:j-e/2-r.width,u=l<a.detail.image.rows/2?l+f/2:l-f/2;m.fillText("Mean: "+p.mean.toFixed(2),t,u-s),m.fillText("StdDev: "+p.stdDev.toFixed(2),t,u),m.fillText(q,t,u+s)}}function i(b,c){b.addEventListener("CornerstoneImageRendered",h,!1);var d={whichMouseButton:c,lengthVisible:!1,startX:0,startY:0,endX:0,endY:0};k[b]=d,a(b).mousedown(e)}function j(b){b.removeEventListener("CornerstoneImageRendered",h),a(b).unbind("mousedown",e),k[b]=void 0}void 0===d&&(d={});var k={};return d.enableEllipticalRoi=i,d.disableEllipticalRoi=j,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(a,b,d){var e=j/d;for(var f in a){var g=a[f],h=c.distance(b,g);if(e>=h)return g}return void 0}function f(a){for(var b in a){var c=a[b];if(c.active===!0)return c}return void 0}function g(a,b,c){var d=f(a),g=e(a,b,c);return d!=g?(void 0!==g&&(g.active=!0),void 0!=d&&(d.active=!1),!0):!1}function h(c,e,f,g){if(e.visible===!1)return!1;var h=d.findHandleNear(e.handles,f,g);return void 0==h?!1:(a(document).mousemove(function(a){var c=b.pageToImage(element,a.pageX,a.pageY);h.x=c.x,h.y=c.y,b.updateImage(element)}),a(document).mouseup(function(){a(document).unbind("mousemove"),a(document).unbind("mouseup")}),!0)}function i(a,b,c){a.strokeStyle="white",a.lineWidth=1/b.scale;var d=j/b.scale;for(var e in c){var f=c[e];1==f.active&&a.arc(f.x,f.y,d,0,2*Math.PI)}}void 0===d&&(d={});var j=6;return d.findHandleNear=e,d.handleCursorNearHandle=h,d.drawHandles=i,d.activateNearbyHandle=g,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){function e(a,b,c,e){b.handles.start.x=c.x,b.handles.start.y=c.y,b.handles.end.x=c.x,b.handles.end.y=c.y,b.visible=!0,d.handleCursorNearHandle(a,b,c,e)}function f(a){var c=a.currentTarget,f=b.getViewport(c),g=k[c];if(a.which==g.whichMouseButton){var h=b.pageToImage(c,a.pageX,a.pageY);return 1==d.handleCursorNearHandle(a,g,h,f.scale)?void a.stopPropagation():(e(a,g,h,f.scale),void a.stopPropagation())}}function g(a){var b=k[a.detail.element];if(0!=b.visible){var c=a.detail.canvasContext;c.beginPath(),c.strokeStyle="white",c.lineWidth=a.detail.singlePixelLineWidth,c.moveTo(b.handles.start.x,b.handles.start.y),c.lineTo(b.handles.end.x,b.handles.end.y),c.stroke(),c.beginPath(),d.drawHandles(c,a.detail.viewport,b.handles,a.detail.viewport.scale),c.stroke(),c.fillStyle="white",c.font=a.detail.mediumFontSize+" Arial";var e=b.handles.start.x-b.handles.end.x*a.detail.image.columnPixelSpacing,f=b.handles.start.y-b.handles.end.y*a.detail.image.rowPixelSpacing,g=Math.sqrt(e*e+f*f),h=""+g.toFixed(2)+" mm";c.fillText(h,(b.handles.start.x+b.handles.end.x)/2,(b.handles.start.y+b.handles.end.y)/2)}}function h(a){if(0==a.which){var c=a.currentTarget,e=k[c];if(void 0!==e){var f=b.pageToImage(c,a.pageX,a.pageY),g=b.getViewport(c);1==d.activateNearbyHandle(e.handles,f,g.scale)&&b.updateImage(c)}}}function i(b,c){b.addEventListener("CornerstoneImageRendered",g,!1);var d={whichMouseButton:c,visible:!1,handles:{start:{x:0,y:0,active:!1},end:{x:0,y:0,active:!1}}};k[b]=d,a(b).mousedown(f),a(b).mousemove(h)}function j(b){b.removeEventListener("CornerstoneImageRendered",g),a(b).unbind("mousedown",f),k[b]=void 0}void 0===d&&(d={});var k={};return d.enableLength=i,d.disableLength=j,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(c,d){a(c).mousedown(function(e){var f=e.pageX,g=e.pageY,h=e.which;h==d&&(a(document).mousemove(function(a){var d=a.pageX-f,e=a.pageY-g;f=a.pageX,g=a.pageY;var h=b.getViewport(c);h.centerX+=d/h.scale,h.centerY+=e/h.scale,b.setViewport(c,h)}),a(document).mouseup(function(){a(document).unbind("mousemove"),a(document).unbind("mouseup")}))})}return void 0===c&&(c={}),c.pan=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(c){var d=c.currentTarget,e=h[d];if(c.which==e.whichMouseButton){var f=b.pageToImage(d,c.pageX,c.pageY);e.x=f.x,e.y=f.y,e.visible=!0,b.updateImage(d),a(document).mousemove(function(a){var c=b.pageToImage(d,a.pageX,a.pageY);e.x=c.x,e.y=c.y,b.updateImage(d)}),a(document).mouseup(function(){e.visible=!1,b.updateImage(d),a(document).unbind("mousemove"),a(document).unbind("mouseup")})}}function e(a){var c=h[a.detail.element];if(0!=c.visible){var d=a.detail.canvasContext;d.beginPath(),d.fillStyle="white",d.font=a.detail.mediumFontSize+" Arial";var e=b.getStoredPixels(a.detail.element,c.x,c.y,1,1),f=e[0],g=f*a.detail.image.slope+a.detail.image.intercept,i=""+Math.round(c.x)+","+Math.round(c.y)+" SP: "+f+" MO: "+g;d.fillText(i,c.x+3,c.y-3)}}function f(b,c){b.addEventListener("CornerstoneImageRendered",e,!1);var f={whichMouseButton:c,visible:!1,x:0,y:0};h[b]=f,a(b).mousedown(d)}function g(b){b.removeEventListener("CornerstoneImageRendered",e),a(b).unbind("mousedown",d),h[b]=void 0}void 0===c&&(c={});var h={};return c.enableProbe=f,c.disableProbe=g,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(c){var d=c.currentTarget,e=j[d];if(c.which==e.whichMouseButton){var f=b.pageToImage(d,c.pageX,c.pageY);e.startX=f.x,e.startY=f.y,e.endX=f.x,e.endY=f.y,e.lengthVisible=!0,a(document).mousemove(function(a){var c=b.pageToImage(d,a.pageX,a.pageY);e.endX=c.x,e.endY=c.y,b.updateImage(d)}),a(document).mouseup(function(){a(document).unbind("mousemove"),a(document).unbind("mouseup")})}}function e(a,b){if(0==f)return{count:f,mean:0,variance:0,stdDev:0};for(var c=Math.round(2*b),d=0,e=0,f=0,g=0,h=0;c>h;h++)for(var i=0;c>i;i++)d+=a[g],e+=a[g]*a[g],f++,g++;var j=d/f,k=e/f-j*j;return{count:f,mean:j,variance:k,stdDev:Math.sqrt(k)}}function f(a){var c=j[a.detail.element];if(0!=c.lengthVisible){var d=Math.abs(c.startX-c.endX),f=Math.abs(c.startY-c.endY),g=Math.max(d,f)/2,h=(c.startX+c.endX)/2,i=(c.startY+c.endY)/2,k=Math.min(c.startX,c.endX),l=Math.min(c.startY,c.endY),m=a.detail.canvasContext;m.beginPath(),m.strokeStyle="white",m.lineWidth=a.detail.singlePixelLineWidth,m.rect(k,l,d,f),m.stroke(),m.fillStyle="white",m.font=a.detail.mediumFontSize+" Arial";var n=d*a.detail.image.columnPixelSpacing*f*a.detail.image.rowPixelSpacing,n="Area: "+n.toFixed(2)+" mm^2",o=m.measureText(n),p=15/a.detail.viewport.scale,q=h<a.detail.image.columns/2?h+d/2:h-d/2-o.width,r=i<a.detail.image.rows/2?i+f/2:i-f/2,s=b.getStoredPixels(a.detail.element,h-g,i-g,2*g,2*g),t=e(s,g);m.fillText("Mean: "+t.mean.toFixed(2),q,r-p),m.fillText("StdDev: "+t.stdDev.toFixed(2),q,r),m.fillText(n,q,r+p)}}function g(){}function h(b,c){b.addEventListener("CornerstoneImageRendered",f,!1);var e={whichMouseButton:c,lengthVisible:!1,startX:0,startY:0,endX:0,endY:0};j[b]=e,a(b).mousedown(d),a(b).mousemove(g)}function i(b){b.removeEventListener("CornerstoneImageRendered",f),a(b).unbind("mousedown",d),j[b]=void 0}void 0===c&&(c={});var j={};return c.enableRectangleRoi=h,c.disableRectangleRoi=i,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(c,d,e){var f=0;0==e?a(c).on("mousewheel DOMMouseScroll",function(a){return a.originalEvent.wheelDelta<0||a.originalEvent.detail>0?f<d.length-1&&(f++,b.showImage(c,d[f])):f>0&&(f--,b.showImage(c,d[f])),!1}):a(c).mousedown(function(g){var h=g.pageX,i=g.pageY,j=g.which;j==e&&(a(document).mousemove(function(a){var e=(a.pageX-h,a.pageY-i);h=a.pageX,i=a.pageY,0>e?f<d.length-1&&(f++,b.showImage(c,d[f])):e>0&&f>0&&(f--,b.showImage(c,d[f]))}),a(document).mouseup(function(){a(document).unbind("mousemove"),a(document).unbind("mouseup")}))})}return void 0===c&&(c={}),c.scroll=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(c){var d=c.data.whichMouseButton,e=c.pageX,f=c.pageY,g=c.which;if(g==d){var h=c.currentTarget;a(document).mousemove(function(a){var c=a.pageX-e,d=a.pageY-f;e=a.pageX,f=a.pageY;var g=b.getViewport(h);g.windowWidth+=c/g.scale,g.windowCenter+=d/g.scale,b.setViewport(h,g)}),a(document).mouseup(function(){a(document).unbind("mousemove"),a(document).unbind("mouseup")})}}function e(b,c){var e={whichMouseButton:c};a(b).mousedown(e,d)}function f(b){a(b).unbind("mousedown",d)}return void 0===c&&(c={}),c.windowWidthWindowCenter=e,c.disableWindowWidthWindowCenter=f,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){function d(c,d){0==d?a(c).on("mousewheel DOMMouseScroll",function(a){if(a.originalEvent.wheelDelta<0||a.originalEvent.detail>0){var d=b.getViewport(c);d.scale-=.25,b.setViewport(c,d)}else{var d=b.getViewport(c);d.scale+=.25,b.setViewport(c,d)}return!1}):a(c).mousedown(function(e){var f=e.pageX,g=e.pageY,h=e.which;h==d&&(a(document).mousemove(function(a){var d=(a.pageX-f,a.pageY-g);f=a.pageX,g=a.pageY;var e=b.getViewport(c);e.scale+=d/100,b.setViewport(c,e)}),a(document).mouseup(function(){a(document).unbind("mousemove"),a(document).unbind("mouseup")}))})}return void 0===c&&(c={}),c.zoom=d,c}($,cornerstone,cornerstoneTools);