var cornerstoneCore=function(a){function b(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function c(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)}return void 0===a&&(a={}),a.distance=c,a.distanceSquared=b,a}(cornerstoneCore),cornerstoneCore=function(a){function b(a,b,c,d,e){var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.beginPath(),a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l),a.closePath(),a.stroke()}return void 0===a&&(a={}),a.drawEllipse=b,a}(cornerstoneCore),cornerstoneCore=function(a){function b(b,d){var f=b.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0),f.fillStyle="black",f.fillRect(0,0,b.canvas.width,b.canvas.height),f.save(),c(b,f),d.windowCenter=b.viewport.windowCenter,d.windowWidth=b.viewport.windowWidth;var g=a.generateLut(d),h=e.getContext("2d"),i=h.createImageData(d.columns,d.rows);a.storedPixelDataToCanvasImageData(d,g,i.data),h.putImageData(i,0,0);b.viewport.scale;f.drawImage(e,0,0,d.columns,d.rows,0,0,d.columns,d.rows),f.restore();var j=new CustomEvent("CornerstoneImageRendered",{detail:{canvasContext:f,viewport:b.viewport,image:b.image,element:b.element,enabledElement:b},bubbles:!1,cancelable:!1});b.element.dispatchEvent(j)}function c(a,b){b.setTransform(1,0,0,1,0,0),b.translate(a.canvas.width/2,a.canvas.height/2),b.scale(a.viewport.scale,a.viewport.scale),b.translate(a.viewport.centerX,a.viewport.centerY),b.translate(-a.image.columns/2,-a.image.rows/2)}function d(a,b,c){b.setTransform(1,0,0,1,0,0),b.translate(a.canvas.width/2,a.canvas.height/2),b.scale(a.viewport.scale,a.viewport.scale),b.translate(a.viewport.centerX,a.viewport.centerY);var d=.1;b.scale(d,d),b.translate(-a.image.columns/2/d,-a.image.rows/2/d);var e=c/a.viewport.scale/d,f=c/a.viewport.scale/d;return{fontSize:e,lineHeight:f,fontScale:d}}void 0===a&&(a={});var e=document.createElement("canvas");return e.width=1024,e.height=1024,a.drawImage=b,a.setToPixelCoordinateSystem=c,a.setToFontCoordinateSystem=d,a}(cornerstoneCore),cornerstoneCore=function(a){function b(a){for(var b=[],c=a.minPixelValue;c<=a.maxPixelValue;c++){var d=c*a.slope+a.intercept;voiLutValue=255*((d-a.windowCenter)/a.windowWidth+.5);var e=Math.min(Math.max(voiLutValue,0),255);b[c]=Math.round(e)}return b}return void 0===a&&(a={}),a.generateLut=b,a}(cornerstoneCore),cornerstoneCore=function(a){function b(a,b){var c=new XMLHttpRequest;c.open("get",a,!0),c.responseType="arraybuffer",c.onload=function(){b(c.response)},c.send()}return void 0===a&&(a={}),a.readPixelData=b,a}(cornerstoneCore),cornerstoneCore=function(a){function b(a,b,c){for(var d=0,e=0,f=0;f<a.rows;f++)for(var g=0;g<a.columns;g++){var h=a.storedPixelData[e++],i=b[h];c[d++]=i,c[d++]=i,c[d++]=i,c[d++]=255}}return void 0===a&&(a={}),a.storedPixelDataToCanvasImageData=b,a}(cornerstoneCore),cornerstone=function(a){function b(b,c,d){var e=document.createElement("canvas");e.width=b.clientWidth,e.height=b.clientHeight,b.appendChild(e);var f={element:b,canvas:e,ids:{imageId:c},data:{}};a.addEnabledElement(f);var g=a.loadImage(c);g.done(function(c){var g=a.resetViewport(b,e,c);if(d)for(var h in g)null!==d[h]&&(g[h]=d[h]);f.image=c,f.viewport=g,a.updateImage(b);var i=new CustomEvent("CornerstoneViewportUpdated",{detail:{viewport:g,element:b},bubbles:!1,cancelable:!1});b.dispatchEvent(i)})}return void 0===a&&(a={}),a.enable=b,a}(cornerstone,cornerstoneCore),cornerstone=function(a){function b(a){for(var b=0;b<g.length;b++)if(g[b].element==a)return g[b];return void 0}function c(a){g.push(a)}function d(a){for(var b=0;b<g.length;b++)if(g[b].element==a)return g[b].element.removeChild(g[b].canvas),void g.splice(b,1)}function e(a,c){var d=b(a);return 0==d.data.hasOwnProperty(c)&&(d.data[c]={}),d.data[c]}function f(a,c){var d=b(a);delete d.data[c]}void 0===a&&(a={});var g=[];return a.getEnabledElement=b,a.addEnabledElement=c,a.removeEnabledElement=d,a.getElementData=e,a.removeElementData=f,a}(cornerstone,cornerstoneCore),cornerstone=function(a){function b(b){var c=a.getEnabledElement(b),d=c.canvas.height/c.image.rows,e=c.canvas.width/c.image.columns;c.viewport.scale=d>e?e:d,c.viewport.centerX=0,c.viewport.centerY=0,a.updateImage(b)}return void 0===a&&(a={}),a.fitToWindow=b,a}(cornerstone,cornerstoneCore),cornerstone=function(a){function b(a){var b=a.indexOf(":"),c=a.substring(0,b),d=g[c];if(void 0===d||null===d){if(void 0!==f){var e=f(a);return e}return void 0}var e=d(a);return e}function c(a){if(void 0===h[a]){var c=b(a);return h[a]=c,c}return h[a]}function d(a,b){g[a]=b}function e(a){var b=f;return f=a,b}void 0===a&&(a={});var f,g={},h={};return a.loadImage=c,a.registerImageLoader=d,a.registerUnknownImageLoader=e,a}(cornerstone,cornerstoneCore),cornerstone=function(a){function b(a,b){var c=a.getAttribute(b);return void 0===c?void 0:c}function c(){for(var c=document.querySelectorAll("[data-cornerstoneEnabled]"),d=0;d<c.length;d++){var e=c[d],f=e.getAttribute("data-cornerstoneImageId"),g={scale:b(e,"data-cornerstoneViewportScale"),centerX:b(e,"data-cornerstoneViewportCenterX"),centerY:b(e,"data-cornerstoneViewportCenterY"),windowWidth:b(e,"data-cornerstoneViewportWindowWidth"),windowCenter:b(e,"data-cornerstoneViewportWindowCenter")};a.enable(e,f,g)}}void 0===a&&(a={});var d=window.onload;return window.onload=function(){"function"==typeof d&&d(),c()},a.enableAllElements=c,a}(cornerstone,cornerstoneCore),cornerstone=function(a){function b(b,c,d){enabledElement=a.getEnabledElement(b),enabledElement.ids.imageId=c;var e=a.loadImage(c);e.done(function(c){if(enabledElement.image=c,d)for(var e in d)null!==d[e]&&(enabledElement.viewport[e]=d[e]);a.updateImage(b)})}function c(b,c,d){if(enabledElement=a.getEnabledElement(b),enabledElement.ids.imageId=c,enabledElement.image=a.loadImage(c),enabledElement.viewport=a.resetViewport(enabledElement.element,enabledElement.canvas,enabledElement.image),d)for(var e in d)null!==d[e]&&(enabledElement.viewport[e]=d[e]);a.updateImage(b)}return void 0===a&&(a={}),a.showImage=function(b,c,d){if(enabledElement=a.getEnabledElement(b),enabledElement.ids.imageId=c,enabledElement.image=a.loadImage(c),d)for(var e in d)null!==d[e]&&(enabledElement.viewport[e]=d[e]);a.updateImage(b)},a.replaceImage=function(b,c,d){a.removeEnabledElement(b),a.enable(b,c,d)},a.newStackImage=b,a.newStack=c,a}(cornerstone,cornerstoneCore),cornerstone=function(a){function b(b,c,d,e,f){c=Math.round(c),d=Math.round(d);for(var g=a.getEnabledElement(b),h=[],i=0,j=0;f>j;j++)for(var k=0;e>k;k++){var l=(j+d)*g.image.columns+(k+c);h[i++]=g.image.storedPixelData[l]}return h}return void 0===a&&(a={}),a.getStoredPixels=b,a}(cornerstone,cornerstoneCore),cornerstone=function(a,b){function c(c){var d=a.getEnabledElement(c),e=d.image;b.drawImage(d,e)}return void 0===a&&(a={}),a.updateImage=c,a}(cornerstone,cornerstoneCore),cornerstone=function(a){function b(b,c){enabledElement=a.getEnabledElement(b),c.windowWidth<1&&(c.windowWidth=1),c.scale<1e-4&&(c.scale=.25),enabledElement.viewport=c,a.updateImage(b);var d=new CustomEvent("CornerstoneViewportUpdated",{detail:{viewport:c,element:b,image:enabledElement.image},bubbles:!1,cancelable:!1});b.dispatchEvent(d)}function c(b){return a.getEnabledElement(b).viewport}function d(b,c,d){var e=a.getEnabledElement(b),f=b.getBoundingClientRect(),g=c-f.left-window.scrollX,h=d-f.top-window.scrollY,i=g-f.width/2,j=h-f.height/2,k=e.viewport,l=i/k.scale,m=j/k.scale,n=l-k.centerX,o=m-k.centerY;return n+=e.image.columns/2,o+=e.image.rows/2,{x:n,y:o}}function e(a,b,c){var d={scale:1,centerX:0,centerY:0,windowWidth:c.windowWidth,windowCenter:c.windowCenter},e=b.height/c.rows,f=b.width/c.columns;return d.scale=e>f?f:e,d}return void 0===a&&(a={}),a.getViewport=c,a.setViewport=b,a.pageToImage=d,a.resetViewport=e,a}(cornerstone,cornerstoneCore);!function(a){function b(){for(var a={minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:127,windowWidth:256,storedPixelData:[],rows:128,columns:256,height:128,width:256,color:!1,columnPixelSpacing:1,rowPixelSpacing:1},b=0,c=Math.round(255*Math.random()),d=0;d<a.rows;d++)for(var e=0;e<a.columns;e++)a.storedPixelData[b]=(e+c)%256,b++;return a}return a.registerImageLoader("test",b),a}(cornerstone),function(a){function b(){for(var a={minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:127,windowWidth:256,storedPixelData:[],rows:256,columns:256,height:256,width:256,color:!1,columnPixelSpacing:1,rowPixelSpacing:1},b=0,c=0;c<a.rows;c++)for(var d=0;d<a.columns;d++)a.storedPixelData[b]=0,b++}a.registerUnknownImageLoader(b)}(cornerstone),function(a){function b(a,b){return a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24)}function c(a,b){return a[b]+(a[b+1]<<8)}function d(a,b,c){for(var d="",e=0;c>e;e++){var f=a[b+e];0!=f&&(d+=String.fromCharCode(f))}return d}function e(a,b,c,d){for(;b<a.length;){var e=p(a,b,d);if(b=e.dataOffset+e.length,c[e.tag]=e,65534===e.groupNumber&&57357===e.elementNumber)return b}return b}function f(a,b,c,d,e){if(b+c>a.length)throw"sequence item offsets mismatch";for(;b+c>b;){var f=p(a,b,e);b=f.dataOffset+f.length,d[f.tag]=f}}function g(a,d,g){var h=c(a,d),i=c(a,d+2),j=b(a,d+4);d+=8;var k={groupNumber:h,elementNumber:i,elements:{},length:j,dataOffset:d};return-1===j?(d=e(a,d,k,g),k.length=d-k.dataOffset):f(a,d,j,k,g),k}function h(a,b,c){b.items=[];for(var d=b.dataOffset;d<a.length;){var e=g(a,d,c);if(d+=e.length+8,b.items.push(e),65534===e.groupNumber&&57565===e.elementNumber)return b.length=d-b.dataOffset,d}b.length=d-b.dataOffset}function i(a,b,c){b.items=[];for(var d=b.dataOffset;d<b.dataOffset+b.length;){var e=g(a,d,c);d+=e.length+8,b.items.push(e)}}function j(a){return"AT"===a||"FL"===a||"FD"===a||"OB"===a||"OF"===a||"OW"===a||"SI"===a||"SQ"===a||"SS"===a||"UL"===a||"US"===a?!1:!0}function k(a,e){j(e.vr)?e.str=d(a,e.dataOffset,e.length):"UL"==e.vr?e.uint32=b(a,e.dataOffset):"US"==e.vr?e.uint16=c(a,e.dataOffset):"SQ"==e.vr&&(-1===e.length?h(a,e,!0):i(a,e,!0))}function l(a,e){e.str=d(a,e.dataOffset,e.length),4===e.length?e.uint32=b(a,e.dataOffset):2===attr.length&&(e.uint16=c(a,e.dataOffset))}function m(a){return"OB"===a||"OW"===a||"SQ"===a||"OF"===a||"UT"===a||"UN"===a?4:2}function n(a,d,e){var f=m(e.vr);2===f?(e.length=c(a,d+6),e.dataOffset=d+8):(e.length=b(a,d+8),e.dataOffset=d+12)}function o(a,c,d){d.length=b(a,c+4),d.dataOffset=c+8}function p(a,b,e){var f=c(a,b),g=c(a,b+2),h=("00000000"+((f<<16)+g).toString(16)).substr(-8),i={groupNumber:f,elementNumber:g,tag:"x"+h};return e===!0?(i.vr=d(a,b+4,2),n(a,b,i),k(a,i)):(o(a,b,i),l(a,i)),i}function q(a){var b=a.x00020010.str;return"1.2.840.10008.1.2"===b?!1:"1.2.840.10008.1.2.2"===b?void 0:!0}function r(a){return 68!==a[128]||73!==a[129]||67!==a[130]||77!==a[131]}function s(a){var b=new Uint8Array(a);if(r(b))return void 0;var c={},d=132,e=p(b,d,!0);d=e.dataOffset+e.length,c[e.tag]=e;for(var f=d+e.uint32;f>d;){var g=p(b,d,!0);d=g.dataOffset+g.length,c[g.tag]=g}var h=q(c);if(void 0===h)return void 0;for(;d<b.length;){var g=p(b,d,h);d=g.dataOffset+g.length,c[g.tag]=g}return c}return a.parseDicom=s,a}(cornerstone),function(a,b){function c(a){var b=a.x00280030;if(b&&b.str.length>0){var c=b.str.split("\\"),d={row:parseFloat(c[0]),column:parseFloat(c[1])};return d}var d={row:void 0,column:void 0};return d}function d(a){var b=a.x00280103.uint16,c=a.x00280100.uint16;return 0===b&&8===c?1:0===b&&16===c?2:1===b&&16===c?3:void 0}function e(a,b){var c=d(a),e=a.x7fe00010,f=e.dataOffset;return 1===c?new Uint8Array(b,f):2===c?new Uint16Array(b,f):3===c?new Int16Array(b,f):void 0}function f(a){var b={intercept:0,slope:1},c=a.x00281052,d=a.x00281053;return c&&c.str.length>0&&(b.intercept=parseFloat(c.str)),d&&d.str.length>0&&(b.slope=parseFloat(d.str)),b}function g(a){var b={windowCenter:void 0,windowWidth:void 0},c=a.x00281050,d=a.x00281051;if(c&&c.str.length>0){var e=c.str.split("\\");b.windowCenter=parseFloat(e[0])}if(d&&d.str.length>0){var e=d.str.split("\\");b.windowWidth=parseFloat(e[0])}return b}function h(a){for(var b=65535,c=-32768,d=a.width*a.height,e=a.storedPixelData,f=0;d>f;f++){var g=e[f];b=Math.min(b,g),c=Math.max(c,g)}a.minPixelValue=b,a.maxPixelValue=c}function i(a){var d=b.parseDicom(a),i=c(d),j=d.x00280010.uint16,k=d.x00280010.uint16,l=f(d),m=g(d),n={minPixelValue:-32767,maxPixelValue:65535,slope:l.slope,intercept:l.intercept,windowCenter:m.windowCenter,windowWidth:m.windowWidth,storedPixelData:e(d,a),rows:j,columns:k,height:j,width:k,color:!1,columnPixelSpacing:i.column,rowPixelSpacing:i.row,data:d};return h(n),n}function j(b){var c=a.Deferred(),d=new XMLHttpRequest;return d.open("get",b,!0),d.responseType="arraybuffer",d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var a=i(d.response);c.resolve(a)}},d.send(),c}return b.registerImageLoader("http",j),b.registerImageLoader("https",j),b}($,cornerstone);